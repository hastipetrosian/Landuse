```{r}
corners1 <- list(x=c(601500,605000),
                y=c(2835800,2833500))
pts1 <- seq(nrow(dat_upsample))
##introducing test data in the introduced block
test1 <- pts[dat_upsample$x > corners1$x[1] &
            dat_upsample$x < corners1$x[2] &
            dat_upsample$y < corners1$y[1] &
            dat_upsample$y > corners1$y[2]]

##setdiff indicates which elements of a vector or data frame X are not existent in a vector or data frame Y.
train1 <- setdiff(pts,test)
plot(y~x,data=dat_upsample[train1,])
grid(nx=4,ny=4,col=5)
with(dat_upsample[test1,], points(x,y,col=2,pch=16))
```

```{r train_testdata}
##number of k
numFolds <- trainControl(method = "cv", number = 10)
##trainand
train3 <- PA_data[train1,]
test3 <- PA_data[test1, ]
train3$geometry <- NULL
test3$geometry <- NULL
```

Random forest

```{r random_forest_buffer3}
rfbc3 <- randomForest(formula= factor(change2) ~ . - landuse - change,
                       data = train3, n.trees=250,interaction.depth=7,
                       ## do.trace=1,
                       type="classification", proximity=TRUE, trcontrol=umFolds, keep.inbag = TRUE)
plot(rfbc3)
varImpPlot(rfbc3)
predbc3 <- predict(rfbc3, newdata=test3, typeprobs="prob", predict.all=TRUE)
if (!file.exists("conb")) {
    conb <- caret::confusionMatrix(predb3$aggregate, as.factor(test3$change2))
    save("conb",file="conb")
} else {
    load("conb")
}

if (!file.exists("table4.rda")) {
    table4=table(test3$change2, predb3$aggregate)
    save("table4",file="table4.rda")
} else {
    load("table3.rda")
}
set_tree = rpart(change2 ~ . -change -landuse ,
                 data =train3)
rpart.plot(set_tree)
```


ROC_random_forest_buffer
```{r roc_random_forest_buffer3_roc, message=TRUE}
ff3 <-  factor(test3$change,
              ## 0 = no gain,  1 = gain
              levels=c(0,1),  ## these are the values in the original vector
              labels=c("no gain","gain") ## these will be the names in the new vector
              )
table(test3$change)
table(ff3)
## convert a two-level factor back to 0/1
to_binary3 <- function(x) { as.numeric(x) -1 }
rocCurve3 <- pROC::roc(to_binary(ff3),
                      ## predb3[,"change"]
                      to_binary(predbc3$aggregate))
caret::confusionMatrix(ff, predbc3$aggregate)
## gain/no gain  vs.  change/no change
plot(rocCurve)

## undebug(pROC:::roc.default)


pp <- pROC::roc(sample(0:1,size=50,replace=TRUE), pred=runif(50))
plot(pp)
plot(pROC::roc(c(1,1,0,0), pred=c(0.2,0.4,0.1,0.2)))
plot(pROC::roc(c(1,0), pred=c(0.2,0.2)))
## we know this won't work because it only has one data point,
## we need at least one observation in each level
try(plot(pROC::roc(factor(1, levels=0:1), pred=0.2)), silent=TRUE)
 
plot(rocCurve ,col=c(4))
###calculate the area under curve (bigger is better)
## extract AUC and drop extra information
auc <- function(x) c(x$auc)
auc(rocCurve)
```

nge2 ~ . -change -landuse ,
                 data =train2)
rpart.plot(set_tree)
```

```{r out_of_bag_error}
rfb3$err.rate[,1]
plot(rfb3$err.rate[,1], type = "l")
```
H-P:Error in roc.default(to_binary(ff), to_binary(predb3)) : 
  'response' must have two levels
```{r roc_random_forest_buffer3_roc, message=TRUE}

```
